pipeline {
    agent any

    environment {
        EC2_IP = '3.88.90.213'  // Substitua pelo IP público da sua instância EC2
        SSH_KEY_PATH = 'C:/Users/USER/Downloads/chave_jenkins.pem'  // Caminho da sua chave privada SSH
    }

    stages {
        stage('Test SSH Connection') {
            steps {
                script {
                    try {
                        // Testando a conexão SSH com o cmd
                        echo "Iniciando a conexão SSH com a EC2..."
                        def command = """cmd /c "ssh -i ${SSH_KEY_PATH} ec2-user@${EC2_IP} uptime" """
                        def result = bat(script: command, returnStdout: true, returnStderr: true, wait: true)

                        // Exibe o resultado do comando SSH
                        echo "Resultado do comando SSH: ${result}"
                    } catch (Exception e) {
                        echo "Erro ao tentar conectar via SSH: ${e.getMessage()}"
                    }
                }
            }
        }
    }

    post {
        success {
            echo "Conexão SSH bem-sucedida com a EC2!"
        }
        failure {
            echo "Falha na conexão SSH com a EC2!"
        }
    }
}
