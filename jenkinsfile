pipeline {
    agent any

    environment {
        EC2_IP = '3.88.90.213'  // Substitua pelo IP público da sua instância EC2
        SSH_KEY_PATH = 'C:/Users/USER/Downloads/chave_jenkins'  // Caminho da sua chave privada SSH
    }

    stages {
        stage('Test SSH Connection') {
            steps {
                script {
                    try {
                        // Tente se conectar à EC2 via SSH
                        echo "Iniciando a conexão SSH com a EC2..."
                        def command = """powershell -Command "ssh -i '${SSH_KEY_PATH}' ec2-user@${EC2_IP} 'echo Conexão SSH bem-sucedida!'"""
                        def result = bat(script: command, returnStdout: true, wait: true)
                        
                        // Exibe o resultado do comando SSH
                        echo "Resultado do SSH: ${result}"
                    } catch (Exception e) {
                        echo "Erro ao tentar conectar via SSH: ${e.getMessage()}"
                    }
                }
            }
        }
    }

    post {
        success {
            echo "Conexão SSH bem-sucedida com a EC2!"
        }
        failure {
            echo "Falha na conexão SSH com a EC2!"
        }
    }
}
